!function(t){var n=function(){"undefined"!=typeof console&&o.debug===!0&&("Microsoft Internet Explorer"==navigator.appName?1==arguments.length?console.log("[KEditor]",arguments[0]):2==arguments.length?console.log("[KEditor]",arguments[0],arguments[1]):arguments.length>2&&console.log("[KEditor]",arguments[0],arguments[1],arguments[2]):console.log(["KEditor"],arguments))},e=function(t){throw new Error("[KEditor] "+t)};t.fn.draggable||e("$.fn.draggable does not exist. Please import $.fn.draggable into your document for continue using KEditor."),t.fn.droppable||e("$.fn.droppable does not exist. Please import $.fn.droppable into your document for continue using KEditor."),t.fn.sortable||e("$.fn.sortable does not exist. Please import $.fn.sortable into your document for continue using KEditor.");var o=t.keditor={debug:!0,version:"1.1.0",log:n,error:e,DEFAULTS:{btnMoveContainerText:'<i class="fa fa-sort"></i>',btnMoveComponentText:'<i class="fa fa-arrows"></i>',btnSettingContainerText:'<i class="fa fa-cog"></i>',btnSettingComponentText:'<i class="fa fa-cog"></i>',btnDuplicateContainerText:'<i class="fa fa-files-o"></i>',btnDuplicateComponentText:'<i class="fa fa-files-o"></i>',btnDeleteContainerText:'<i class="fa fa-times"></i>',btnDeleteComponentText:'<i class="fa fa-times"></i>',defaultComponentType:"text",snippetsUrl:"snippets/default/snippets.html",snippetsListId:"keditor-snippets-list",onSidebarToggled:function(t){},onInitContentArea:function(t){},onContentChanged:function(t){},onInitContainer:function(t){},onBeforeContainerDeleted:function(t,n){},onContainerDeleted:function(t,n){},onContainerChanged:function(t,n){},onContainerDuplicated:function(t,n,e){},onContainerSelected:function(t,n){},onContainerSnippetDropped:function(t,n,e){},onComponentReady:function(t){},onInitComponent:function(t){},onBeforeComponentDeleted:function(t,n){},onComponentDeleted:function(t,n){},onComponentChanged:function(t,n){},onComponentDuplicated:function(t,n,e){},onComponentSelected:function(t,n){},onComponentSnippetDropped:function(t,n,e){},onDynamicContentLoaded:function(t,n,e,o){},onDynamicContentError:function(t,n,e,o){}},components:{},generateId:function(t){var n=(new Date).getTime();return"keditor-"+t+"-"+n},initNiceScroll:function(e){n("initNiceScroll",e),t.fn.niceScroll?(n("Initialize $.fn.niceScroll"),e.niceScroll({cursorcolor:"#999",cursorwidth:6,railpadding:{top:0,right:0,left:0,bottom:0},cursorborder:""})):n("$.fn.niceScroll does not exist. Use default sidebar.")},initSidebar:function(i){n("initSidebar",i);var a=t(document.body);a.addClass("opened-keditor-sidebar"),i.snippetsListId===o.DEFAULTS.snippetsListId?(n("Render default KEditor snippet container"),a.append('<div id="keditor-sidebar">   <a id="keditor-sidebar-toggler"><i class="fa fa-chevron-right"></i></a>   <div id="keditor-snippets-list"></div>   <div id="keditor-snippets-content" style="display: none"></div>   <div id="keditor-setting-panel">       <div id="keditor-setting-header"><span id="keditor-setting-title"></span><a href="#" id="keditor-setting-closer"><i class="fa fa-arrow-right"></i></a></div>       <div id="keditor-setting-body"><div id="keditor-setting-forms"></div></div>   </div></div>'),o.initSidebarToggler(i)):(n('Render KEditor snippets content after custom snippets list with id="'+i.snippetsListId+'"'),t("#"+i.snippetsListId).after('<div id="keditor-snippets-content" style="display: none"></div>')),"string"==typeof i.snippetsUrl&&i.snippetsUrl.length>0?(n('Getting snippets form "'+i.snippetsUrl+'"...'),t.ajax({type:"get",dataType:"html",url:i.snippetsUrl,success:function(t){n("Success in getting snippets",t),o.renderSnippets(t,i),o.initSnippets(i),o.initSnippetsSwitcher(i),o.initSettingPanel(i)},error:function(t){n("Error when getting snippets",t)}})):e('"snippetsUrl" must be not null!')},initSidebarToggler:function(e){n("initSidebarToggler",e);var o=t(document.body);t("#keditor-sidebar-toggler").on("click",function(n){n.preventDefault();var i=t(this).find("i"),a=o.hasClass("opened-keditor-sidebar");a?(o.removeClass("opened-keditor-sidebar"),i.attr("class","fa fa-chevron-left")):(o.addClass("opened-keditor-sidebar"),i.attr("class","fa fa-chevron-right")),"function"==typeof e.onSidebarToggled&&e.onSidebarToggled.call(null,!a)})},renderSnippets:function(e,o){n("renderSnippets",e,o);var i="",a="",r="";t("<div />").html(e).find("> div").each(function(e){var o=t(this),s=o.html().trim(),c=o.attr("data-preview"),d=o.attr("data-type"),l="";n("Snippet #"+e+" type="+d,c,s),l+='<section class="keditor-snippet" data-snippet="#keditor-snippet-'+e+'" data-type="'+d+'">',l+='   <img class="keditor-snippet-preview" src="'+c+'" />',l+="</section>","container"===d?i+=l:-1!==d.indexOf("component")&&(a+=l),r+='<script id="keditor-snippet-'+e+'" type="text/html">'+s+"</script>"}),t("#"+o.snippetsListId).html('<ul id="keditor-snippets-type-switcher" class="nav nav-tabs nav-justified">    <li class="active"><a href="#keditor-container-snippets">Containers</a></li>    <li><a href="#keditor-component-snippets">Components</a></li></ul><div id="keditor-snippets-container" class="tab-content">   <div class="tab-pane keditor-snippets active" id="keditor-container-snippets">'+i+'</div>   <div class="tab-pane keditor-snippets" id="keditor-component-snippets">'+a+"</div></div>").addClass("loaded-snippets"),t("#keditor-snippets-content").html(r)},initSnippets:function(e){n("initSnippets",e);var i=t("#"+e.snippetsListId);o.initNiceScroll(i.find(".keditor-snippets")),n("Initialize $.fn.draggable for container snippets list"),i.find(".keditor-snippet[data-type=container]").draggable({helper:"clone",revert:"invalid",connectToSortable:".keditor-content-area",start:function(){t("[contenteditable]").blur(),t(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),t(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar")}}),i.find(".keditor-snippet[data-type^=component]").draggable({helper:"clone",revert:"invalid",connectToSortable:".keditor-container-content",start:function(){t("[contenteditable]").blur(),t(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),t(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),t(document.body).addClass("highlighted-container-content")},stop:function(){t(document.body).removeClass("highlighted-container-content")}})},initSnippetsSwitcher:function(e){n("initSnippetsSwitcher",e);var o=t("#keditor-snippets-type-switcher li"),i=t("#keditor-snippets-container .keditor-snippets");o.find("a").on("click",function(n){n.preventDefault();var e=t(this),a=e.parent(),r=e.attr("href");if(!a.hasClass("active")){var s=o.filter(".active"),c=i.filter(".active"),d=t(r);s.removeClass("active"),c.removeClass("active"),a.addClass("active"),d.addClass("active"),t.fn.niceScroll&&(c.getNiceScroll().hide(),d.getNiceScroll().show())}})},initSettingPanel:function(i){n("initSettingPanel",i),t("#keditor-setting-closer").on("click",function(t){t.preventDefault(),o.hideSettingPanel()});var a=t("#keditor-setting-forms");o.initNiceScroll(a),n('Call "initSettingForm" function of all component types if settingEnabled = true');for(var r in o.components){var s=o.components[r],c=s.settingEnabled===!0;if(n("Type: "+r+", settingEnabled: "+c),c)if("function"==typeof s.initSettingForm){var d=t('<div id="keditor-setting-'+r+'" data-type="'+r+'" class="keditor-setting-form clearfix"></div>');a.append(d),n('Initialize setting form for component type "'+r+'"'),s.initSettingForm.call(s,d,i)}else e('"initSettingForm" function of component type "'+r+'" does not exist!')}},showSettingPanel:function(i,a){n("showSettingPanel",i,a);var r=t("#keditor-setting-forms").children(".active");r.removeClass("active");var s=o.getComponentType(i,a),c=o.components[s];t("#keditor-setting-title").html(c.settingTitle);var d=t("#keditor-setting-"+s);"function"==typeof c.showSettingForm?(n('Show setting form of component type "'+s+'"'),c.showSettingForm.call(c,d,i,a),d.addClass("active")):e('"showSettingForm" function of component type "'+s+'" does not exist!'),t(document.body).addClass("opened-keditor-setting")},hideSettingPanel:function(){n("hideSettingPanel"),t(document.body).removeClass("opened-keditor-setting");var e=t("#keditor-setting-forms").children(".active"),i=e.attr("data-type"),a=o.components[i];"function"==typeof a.hideSettingForm&&(n('Hide setting form of component type "'+i+'"'),a.hideSettingForm.call(a,e)),e.removeClass("active"),t(document.body).removeClass("opened-keditor-setting"),o.settingComponent=null},initContentArea:function(e,i){if(n("initContentArea",e,i),e.addClass("keditor-content-area"),n("Initialize $.fn.droppable for content area"),e.droppable({accept:".keditor-snippet[data-type=container]",tolerance:"pointer",greedy:!0}),n("Initialize $.fn.sortable for content area"),e.sortable({handle:".btn-container-reposition",items:"> section",connectWith:".keditor-content-area",axis:"y",tolerance:"pointer",sort:function(){t(this).removeClass("ui-state-default")},receive:function(a,r){n("On received snippet",a,r);var s=r.helper,c=r.item;if(c.is(".keditor-snippet")){var d=t(c.attr("data-snippet")).html();n("Snippet content",d);var l=t('<section class="keditor-container">   <section class="keditor-container-inner">'+d+"</section></section>");s.replaceWith(l),l.hasClass("showed-keditor-toolbar")||(t(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),l.addClass("showed-keditor-toolbar")),"function"==typeof i.onContainerSnippetDropped&&i.onContainerSnippetDropped.call(e,a,l,r.item),o.initContainer(e,l,i)}"function"==typeof i.onContentChanged&&i.onContentChanged.call(e,a)}}),n("Initialize existing containers in content area"),e.children("section").each(function(){o.convertToContainer(e,t(this),i)}),"function"==typeof i.onInitContentArea){var a=i.onInitContentArea.call(e,e);a&&a.length>0&&t.each(a,function(){o.convertToContainer(e,t(this),i)})}},convertToContainer:function(t,n,e){var i,a=n.is("section");a?(n.addClass("keditor-container"),n.wrapInner('<section class="keditor-container-inner"></section>'),i=n):(n.wrap('<section class="keditor-container"><section class="keditor-container-inner"></section></section>'),i=n.parent().parent()),o.initContainer(t,i,e)},initContainer:function(e,i,a){if(n("initContainer",e,i,a),i.hasClass("keditor-initialized-container")&&i.hasClass("keditor-initializing-container"))n(i.hasClass("keditor-initialized-container")?"Container is already initialized!":"Container is initializing...");else{i.addClass("keditor-initializing-container"),n("Render KEditor toolbar for container",i),i.append('<div class="keditor-toolbar keditor-toolbar-container">   <a href="#" class="btn-container-reposition">'+a.btnMoveContainerText+'</a>   <a href="#" class="btn-container-duplicate">'+a.btnDuplicateContainerText+'</a>   <a href="#" class="btn-container-delete">'+a.btnDeleteContainerText+"</a></div>");var r=o.generateId("container");n("Id for container is: "+r),i.attr("id",r);var s=i.find('[data-type="container-content"]');n("Initialize "+s.length+" container content(s)"),s.each(function(){var n=t(this);o.initContainerContent(e,i,n,a)}),"function"==typeof a.onInitContainer&&a.onInitContainer.call(e,i),i.addClass("keditor-initialized-container"),i.removeClass("keditor-initializing-container")}},initContainerContent:function(e,i,a,r){n("initContainerContent",e,i,a,r);var s=o.generateId("container-content");a.addClass("keditor-container-content"),n("Id for container content id: "+s,a),a.attr("id",s),n("Initialize $.fn.droppable for container content"),a.droppable({accept:".keditor-snippet[data-type=component]",tolerance:"pointer",greedy:!0}),n("Initialize $.fn.sortable for container content"),a.sortable({handle:".btn-component-reposition",items:"> section",connectWith:".keditor-container-content",tolerance:"pointer",sort:function(){t(this).removeClass("ui-state-default")},receive:function(i,a){n("On received snippet",i,a);var s,c=a.helper,d=a.item;if(d.is(".keditor-snippet")){var l=t(d.attr("data-snippet")).html(),p=d.attr("data-type");n("Snippet content",l);var f=t('<section class="keditor-component" data-type="'+p+'">   <section class="keditor-component-content">'+l+"</section></section>");c.replaceWith(f),s=f.closest(".keditor-container"),"function"==typeof r.onComponentSnippetDropped&&r.onComponentSnippetDropped.call(e,i,f,a.item),o.initComponent(e,s,f,r)}else s=d.closest(".keditor-container");s.hasClass("showed-keditor-toolbar")||(t(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),s.addClass("showed-keditor-toolbar")),"function"==typeof r.onContainerChanged&&r.onContainerChanged.call(e,i,s),"function"==typeof r.onContentChanged&&r.onContentChanged.call(e,i)}}),n("Initialize existing components inside container content"),a.children().each(function(){var n=t(this);o.convertToComponent(e,i,n,r)})},convertToComponent:function(t,n,e,i){var a,r=e.is("section");r?(e.addClass("keditor-component"),e.wrapInner('<section class="keditor-component-content"></section>'),a=e):(e.wrap('<section class="keditor-component"><section class="keditor-component-content"></section></section>'),a=e.parent().parent()),o.initComponent(t,n,a,i)},getComponentType:function(t,i){var a=t.attr("data-type"),r=a?a.replace("component-",""):"";return r&&r in o.components?r:(n(r?'Component type "'+r+'" does not exist':"This component does not contain data-type attribute"),"string"==typeof i.defaultComponentType?r=i.defaultComponentType:"function"==typeof i.defaultComponentType&&(r=i.defaultComponentType.call(t,t)),r||e("Component type is undefined!"),n("Fallback to defaultComponentType: "+r),r)},initComponent:function(i,a,r,s){if(n("initComponent",i,a,r,s),r.hasClass("keditor-initialized-component")&&r.hasClass("keditor-initializing-component"))n(r.hasClass("keditor-initialized-component")?"Component is already initialized!":"Component is initializing...");else{r.addClass("keditor-initializing-component");var c=r.children(".keditor-component-content"),d=o.generateId("component-content");n("Id for component content is: "+d),c.attr("id",d);var l=o.getComponentType(r,s);n("Component type: "+l);var p=o.components[l],f=p.settingEnabled,C="";f&&(C='<a href="#" class="btn-component-setting">'+s.btnSettingComponentText+"</a>"),n("Render KEditor toolbar for component",r),r.append('<div class="keditor-toolbar keditor-toolbar-component">   <a href="#" class="btn-component-reposition">'+s.btnMoveComponentText+"</a>"+C+'   <a href="#" class="btn-component-duplicate">'+s.btnDuplicateComponentText+'</a>   <a href="#" class="btn-component-delete">'+s.btnDeleteComponentText+"</a></div>");var m=[];r.find("[data-dynamic-href]").each(function(){var n=t(this);m.push(o.initDynamicContent(i,n,s))}),t.when.apply(null,m).then(function(){"function"==typeof p.init?p.init.call(p,i,a,r,s):(t(document.body).removeClass("highlighted-container-content"),e('"init" function of component type "'+l+'" does not exist!')),"function"==typeof s.onInitComponent&&s.onInitComponent.call(i,r),r.addClass("keditor-initialized-component"),r.removeClass("keditor-initializing-component")})}},getClickedElement:function(n,e){var o=t(n.target),i=o.closest(e);return o.is(e)?o:i.length>0?i:null},initKEditorClicks:function(e){n("initKEditorClicks",e);var i=t(document.body);i.on("click",function(i){var a=o.getClickedElement(i,".keditor-container");if(a){if(n("Click on .keditor-container",a,a.hasClass("showed-keditor-toolbar")),!a.hasClass("showed-keditor-toolbar")){t(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),t(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),a.addClass("showed-keditor-toolbar");var r=a.parent();"function"==typeof e.onContainerSelected&&e.onContainerSelected.call(r,i,a)}}else t(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),t(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar");var s=o.getClickedElement(i,".keditor-component");if(s){if(n("Click on .keditor-component",s),!s.hasClass("showed-keditor-toolbar")){t(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),s.addClass("showed-keditor-toolbar");var r=s.parent();"function"==typeof e.onComponentSelected&&e.onComponentSelected.call(r,i,s)}}else t(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar")}),i.on("click",".btn-container-duplicate",function(i){i.preventDefault();var a=t(this);n("Click on .btn-container-duplicate",a);var r=a.closest(".keditor-container"),s=r.parent(),c=t(o.getContainerContent(r));r.after(c),o.convertToContainer(s,c,e),n("Container is duplicated"),"function"==typeof e.onContainerDuplicated&&e.onContainerDuplicated.call(s,r,c),"function"==typeof e.onContentChanged&&e.onContentChanged.call(s,i)}),i.on("click",".btn-container-delete",function(i){i.preventDefault();var a=t(this);if(n("Click on .btn-container-delete",a),confirm("Are you sure that you want to delete this container? This action can not be undo!")){var r=a.closest(".keditor-container"),s=r.find(".keditor-component"),c=r.parent();"function"==typeof e.onBeforeContainerDeleted&&e.onBeforeContainerDeleted.call(c,i,r),s.length>0&&s.each(function(){o.deleteComponent(t(this),e)}),r.remove(),"function"==typeof e.onContainerDeleted&&e.onContainerDeleted.call(c,i,r),"function"==typeof e.onContentChanged&&e.onContentChanged.call(c,i)}}),i.on("click",".btn-component-setting",function(a){a.preventDefault();var r=t(this);n("Click on .btn-component-setting",r);var s=r.closest(".keditor-component");i.hasClass("opened-keditor-setting")&&s.is(o.settingComponent)?o.hideSettingPanel():(o.settingComponent=s,o.showSettingPanel(s,e))}),i.on("click",".btn-component-duplicate",function(i){i.preventDefault();var a=t(this);n("Click on .btn-component-duplicate",a);var r=a.closest(".keditor-component"),s=r.closest(".keditor-container"),c=s.parent(),d=t(o.getComponentContent(r));r.after(d),o.convertToComponent(c,s,d,e),n("Component is duplicated"),"function"==typeof e.onComponentDuplicated&&e.onComponentDuplicated.call(c,r,d),"function"==typeof e.onContainerChanged&&e.onContainerChanged.call(c,i,s),"function"==typeof e.onContentChanged&&e.onContentChanged.call(c,i)}),i.on("click",".btn-component-delete",function(i){i.preventDefault();var a=t(this);if(n("Click on .btn-component-delete",a),confirm("Are you sure that you want to delete this component? This action can not be undo!")){var r=a.closest(".keditor-component"),s=r.closest(".keditor-content-area");"function"==typeof e.onBeforeComponentDeleted&&e.onBeforeComponentDeleted.call(s,i,r),o.deleteComponent(r,e),"function"==typeof e.onComponentDeleted&&e.onComponentDeleted.call(s,i,r),"function"==typeof e.onContainerChanged&&e.onContainerChanged.call(s,i,r),"function"==typeof e.onContentChanged&&e.onContentChanged.call(s,i)}})},deleteComponent:function(t,i){n("deleteComponent",t,i);var a=o.getComponentType(t,i);"function"==typeof o.components[a].destroy?o.components[a].destroy(t,i):e('"destroy" function of component type "'+a+'" does not exist!'),t.remove()},initDynamicContent:function(e,o,i){n("initDynamicContent",e,o,i);var a=o.attr("data-dynamic-href"),r={};return t.each(o.get(0).attributes,function(t,n){if(0===n.name.indexOf("data-")&&"data-dynamic-href"!==n.name&&"data-type"!==n.name){var e=n.name.substr(5).replace(/-(.)/g,function(t,n){return n.toUpperCase()});r[e]=n.value}}),r=t.param(r),n("Dynamic href: "+a,"Data: "+r),t.ajax({url:a,data:r,type:"GET",dataType:"HTML",success:function(t,a,r){n("Dynamic content is loaded",o,t,a,r),o.html(t),"function"==typeof i.onDynamicContentLoaded&&i.onDynamicContentLoaded.call(e,o,t,a,r)},error:function(t,a,r){n("Error when loading dynamic content",o,t,a,r),"function"==typeof i.onDynamicContentError&&i.onDynamicContentError.call(e,o,t,a,r)}})},getComponentContent:function(t,n){var i,a=t.attr("data-type"),r=o.getComponentType(t,n);return"function"==typeof o.components[r].getContent?i=o.components[r].getContent(t,n):e('"getContent" function of component type "'+r+'" does not exist!'),'<section data-type="'+a+'">'+i+"</section>"},getContainerContent:function(n,e){var i=n.children(".keditor-container-inner").clone();return i.find("[data-type=container-content]").each(function(){var n=t(this);n.removeClass("keditor-container-content ui-droppable ui-sortable").removeAttr("id"),n.children(".keditor-component").each(function(){var n=t(this);n.replaceWith(o.getComponentContent(n,e))})}),"<section>"+i.html()+"</section>"}};t.fn.keditor=function(t){if(i[t]&&"init"!==t)return i[t].apply(this,Array.prototype.slice.call(arguments,1));if("object"!=typeof t&&t)throw new Error("[KEditor] Method "+t+" does not exist on $.fn.keditor");return i.init.apply(this,arguments)};var i={init:function(e){var i=t(this);e=t.extend({},o.DEFAULTS,e),i.each(function(){var e=t(this);if(0===e.attr("id").length){n("Content area does not contain Id. Generating id for content area...");var i=o.generateId("content-area");e.attr("id",i),n('Id for content are is: "'+i+'"')}});var a=t("#"+e.snippetsListId);return a.hasClass("loaded-snippets")?n("Snippets list is already initialized!"):o.initSidebar(e),o.initKEditorClicks(e),i.each(function(){var i=t(this);i.data("keditorOptions")?n("KEditor is already initialized!"):(i.data("keditorOptions",e),o.initContentArea(i,e))}),i},getContent:function(){var n=t(this),e=i.getOptions.call(n),a="";return n.children(".keditor-container").each(function(){var n=t(this);a+=o.getContainerContent(n,e)}),a},getOptions:function(){return t(this).data("keditorOptions")||o.DEFAULTS}}}(jQuery);
//# sourceMappingURL=keditor-1.1.0.min.js.map
