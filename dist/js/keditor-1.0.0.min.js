/*!
 * KEditor - Kademi content editor
 * @copyright: Kademi (http://kademi.co)
 * @author: Kademi (http://kademi.co)
 * @version: 1.0.0
 * @dependencies: $, $.fn.draggable, $.fn.droppable, $.fn.sortable, $.fn.ckeditor
 *
 * Configuration:
 * @option {Object} ckeditor Configuration for CKEditor. See at http://docs.ckeditor.com/#!/api/CKEDITOR.config
 * @option {String} snippetsUrl Url to snippets file
 * @option {String} [snippetsListId="keditor-snippets-list"] Id of element which contains snippets. As default, value is "keditor-snippets-list" and KEditor will render snippets sidebar automatically. If you specific other id, only snippets will rendered and put into your element
 * @option {Function} onContentChange Callback will be called when content is changed
 */
!function(t){var e=function(){"undefined"!=typeof console&&t.fn.keditor.debug&&("Microsoft Internet Explorer"==navigator.appName?1==arguments.length?console.log("[KEditor]",arguments[0]):2==arguments.length?console.log("[KEditor]",arguments[0],arguments[1]):arguments.length>2&&console.log("[KEditor]",arguments[0],arguments[1],arguments[2]):console.log(["KEditor"],arguments))},n=function(t){throw new Error("[KEditor] "+t)};t.fn.draggable||n("$.fn.draggable does not exist. Please import $.fn.draggable into your document for continue using KEditor."),t.fn.droppable||n("$.fn.droppable does not exist. Please import $.fn.droppable into your document for continue using KEditor."),t.fn.sortable||n("$.fn.sortable does not exist. Please import $.fn.sortable into your document for continue using KEditor."),t.fn.ckeditor?CKEDITOR.disableAutoInline=!0:n("$.fn.ckeditor does not exist. Please import CKEditor and its jQuery adapter into your document for continue using KEditor."),t.fn.keditor=function(t){if(s[t]&&"init"!==t)return s[t].apply(this,Array.prototype.slice.call(arguments,1));if("object"!=typeof t&&t)throw new Error("[KEditor] Method "+t+" does not exist on jquery.keditor");return s.init.apply(this,arguments)},t.fn.keditor.debug=!0,t.fn.keditor.version="1.0.0";var i=t.fn.keditor.DEFAULTS={ckeditor:{allowedContent:!0,bodyId:"editor",templates_replaceContent:!1,enterMode:"P",forceEnterMode:!0,format_tags:"p;h1;h2;h3;h4;h5;h6",format_p2:{element:"p",attributes:{"class":"lessSpace"}},removePlugins:"magicline",minimumChangeMilliseconds:100},snippetsUrl:"snippets.html",snippetsListId:"keditor-snippets-list",onContentChange:function(){}},o={initSnippet:function(s,r){e("initSnippetToggler",s,r);var a=t(document.body);a.addClass("opened-keditor-snippets"),s.addClass("keditor-content-area"),r.snippetsListId===i.snippetsListId?(e("Render default KEditor snippet container"),a.append('<div id="keditor-snippets-container">    <a id="keditor-snippets-toggler"><i class="glyphicon glyphicon-chevron-right"></i></a>    <div id="keditor-snippets-list" class="clearfix"></div>    <div id="keditor-snippets-content" style="display: none"></div></div>'),o.initSnippetToggler()):(e('Render KEditor snippets content after custom snippets list with id="'+r.snippetsListId+'"'),t("#"+r.snippetsListId).after('<div id="keditor-snippets-content" style="display: none"></div>')),"string"==typeof r.snippetsUrl&&r.snippetsUrl.length>0?(e('Getting snippets form "'+r.snippetsUrl+'"...'),t.ajax({type:"get",dataType:"html",url:r.snippetsUrl,success:function(t){e("Success in getting snippets",t),o.renderSnippets(t,r),o.initSnippetsActions(s,r),o.initContentAreaActions(s,r)},error:function(t){e("Error when getting snippets",t)}})):n('"snippetsUrl" must be not null!')},initSnippetToggler:function(){e("initSnippetToggler");var n=t(document.body);t("#keditor-snippets-toggler").on("click",function(e){e.preventDefault();var i=t(this).find("i");n.hasClass("opened-keditor-snippets")?(n.removeClass("opened-keditor-snippets"),i.attr("class","glyphicon glyphicon-chevron-left")):(n.addClass("opened-keditor-snippets"),i.attr("class","glyphicon glyphicon-chevron-right"))})},renderSnippets:function(n,i){e("renderSnippets",n,i);var o="",s="";t("<div />").html(n).find("> div").each(function(n){var i=t(this),r=i.html().trim(),a=i.attr("data-preview");e("Snippet #"+n,a,r),o+='<section class="keditor-snippet" data-snippet="#keditor-snippet-'+n+'">',o+='   <img class="keditor-snippet-preview" src="'+a+'" />',o+="</section>",s+='<div id="keditor-snippet-'+n+'" style="display: none;">'+r+"</div>"}),t("#"+i.snippetsListId).html(o),t("#keditor-snippets-content").html(s)},initSnippetsActions:function(n,i){e("initSnippetsActions",n,i);var o=t("#"+i.snippetsListId);t.fn.niceScroll?(e("Initialize $.fn.niceScroll for snippets list"),o.niceScroll({cursorcolor:"#999",cursorwidth:6,railpadding:{top:0,right:0,left:0,bottom:0},cursorborder:""})):e("$.fn.niceScroll does not exist. Use default sidebar.");var s=n.attr("id");e("Initialize $.fn.draggable for snippets list which connect to #"+s),o.find(".keditor-snippet").draggable({helper:"clone",revert:"invalid",connectToSortable:"#"+s,cursorAt:{top:0,left:0},start:function(){t(".keditor-section-content").blur()}})},initContentAreaActions:function(n,i){e("initContentAreaActions",n,i);var s=t(document.body),r=n.attr("id");e("Initialize $.fn.droppable for content area"),n.droppable({accept:".keditor-snippet",tolerance:"pointer",greedy:!0}),e("Initialize $.fn.sortable for content area"),n.sortable({handle:".btn-section-reposition",items:"> section",connectWith:"#"+r,axis:"y",sort:function(){t(this).removeClass("ui-state-default")},receive:function(n,s){e("On received snippet",n,s);var r=s.helper,a=s.item,d=t(a.attr("data-snippet")).html();e("Snippet content",d);var c=t('<section class="keditor-section">   <section class="keditor-section-content">'+d+"</section></section>");r.replaceWith(c),o.initContentEditable(c,i),"function"==typeof i.onContentChange&&i.onContentChange.call(this,n)}}),e("Initialize sections in content area"),n.find("> section").each(function(){var e=t(this);e.addClass("keditor-section-content"),e.wrap('<section class="keditor-section"></section>');var n=e.parent();o.initContentEditable(n,i)}),s.on("click",function(t){var s=o.getClickElement(t,"section.keditor-section");n.find(".keditor-section.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),s&&(e("Click on .keditor-section"),s.addClass("showed-keditor-toolbar"));var r=o.getClickElement(t,".btn-section-delete");if(r&&(e("Click on .btn-section-delete",r),confirm("Are you sure that you want to delete this section? This action can not be undo!"))){var a=r.closest("section.keditor-section"),d=a.find(".keditor-section-content").attr("id");CKEDITOR.instances[d].destroy(),a.remove(),e("Section is deleted"),"function"==typeof i.onContentChange&&i.onContentChange.call(this,t)}})},getClickElement:function(e,n){var i=t(e.target),o=i.closest(n);return i.is(n)?i:o.length>0?o:null},initContentEditable:function(t,n){if(e("initContentEditable",t,n),t.hasClass("keditor-editable")&&t.hasClass("keditor-initializing"))e(t.hasClass("keditor-editable")?"Section is already initialized!":"Section is initializing...");else{t.addClass("keditor-initializing"),e("Render KEditor toolbar for section",t),t.append('<div class="keditor-toolbar">   <div class="btn-group-vertical">       <a href="#" class="btn btn-xs btn-info btn-section-reposition"><i class="glyphicon glyphicon-sort"></i></a>       <a href="#" class="btn btn-xs btn-danger btn-section-delete"><i class="glyphicon glyphicon-remove"></i></a>   </div></div>'),e("Initialize CKEditor for section",t);var i=t.find(".keditor-section-content");i.prop("contenteditable",!0);var o="keditor-section-"+(new Date).getTime();e("Id for section content is: "+o),i.attr("id",o),i.ckeditor(n.ckeditor),i.on("input",function(t){"function"==typeof n.onContentChange&&n.onContentChange.call(this,t)}),t.addClass("keditor-editable"),t.removeClass("keditor-initializing")}}},s={init:function(n){return t(this).each(function(){var s=t(this);if(s.data("keditorOptions"))e("KEditor is already initialized!");else{if(0===s.attr("id").length){e("Content area does not contain Id. Generating id for content area...");var r="keditor-content-area-"+(new Date).getTime();s.attr("id",r),e('Id for content are is: "'+r+'"')}n=t.extend({},i,n),s.data("keditorOptions",n),o.initSnippet(s,n)}return s})},getContent:function(){var e=t(this),n="";return e.find("> section").each(function(){var e=t(this),i=e.find(".keditor-section-content").attr("id");n+="<section>"+CKEDITOR.instances[i].getData()+"</section>"}),n}}}(jQuery);
//# sourceMappingURL=keditor-1.0.0.min.js.map
